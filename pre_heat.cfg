[gcode_macro PREPARAR_TOOL]
description: PrÃ©-aquece extrusor alvo com antecedÃªncia (manual)
gcode:
  {% set tool = params.TOOL|default(0)|int %}
  {% set temp = params.TEMP|default(0)|int %}
  {% set extruders = {
    1: "extruder",
    2: "extruder1",
    3: "extruder2",
    4: "extruder3"
  } %}

  {% if extruders[tool] is defined %}
    {% if temp > 0 %}
     # SET_HEATER_TEMPERATURE HEATER={extruders[tool]} TARGET={temp}
      RESPOND PREFIX="INFO" MSG="Tool {tool} â†’ prÃ©-aquecendo manualmente para {temp}Â°C"
    {% else %}
      RESPOND PREFIX="WARNING" MSG="Tool {tool} â†’ temperatura nÃ£o definida com TEMP=xxx â€” aquecimento ignorado"
    {% endif %}
  {% else %}
    RESPOND PREFIX="ERROR" MSG="Tool {tool} invÃ¡lida ou extrusora nÃ£o existente"
  {% endif %}
  
  
  
  
[gcode_macro GERENCIAR_TEMPERATURAS]
description: "Gerencia temperaturas de standby e aquecimento preditivo"
variable_TOOL: 0
gcode:
  {% set next_tool = params.TOOL|int %}
  {% set tool = printer["gcode_macro TOOL_STATE"].tool|int %}
  {% set next_tool = params.TOOL|int %}

  {% set extruders = {
    1: "extruder",
    2: "extruder1",
    3: "extruder2",
    4: "extruder3"
  } %}

  ; ðŸ”¥ Temperaturas definidas por ferramenta
  {% set standby = {
    1: printer["gcode_macro TOOL_DATA"].standby_temp_T1|default(170)|int,
    2: printer["gcode_macro TOOL_DATA"].standby_temp_T2|default(170)|int,
    3: printer["gcode_macro TOOL_DATA"].standby_temp_T3|default(170)|int,
    4: printer["gcode_macro TOOL_DATA"].standby_temp_T4|default(170)|int
  } %}

  {% set trabalho = {
    1: printer["gcode_macro TOOL_DATA"].work_temp_T1|default(210)|int,
    2: printer["gcode_macro TOOL_DATA"].work_temp_T2|default(210)|int,
    3: printer["gcode_macro TOOL_DATA"].work_temp_T3|default(210)|int,
    4: printer["gcode_macro TOOL_DATA"].work_temp_T4|default(210)|int
  } %}

  ; ðŸ§Š Resfria extrusor atual
  {% if tool != 0 %}
    #SET_HEATER_TEMPERATURE HEATER={extruders[tool]} TARGET={standby[tool]}
    # RESPOND PREFIX="INFO" MSG="Tool {tool} em standby ({standby[tool]}Â°C)"
  {% endif %}

  ; ðŸ”¥ PrÃ©-aquece prÃ³xima ferramenta
  {% if extruders[next_tool] is defined %}
   # SET_HEATER_TEMPERATURE HEATER={extruders[next_tool]} TARGET={trabalho[next_tool]}
   # RESPOND PREFIX="INFO" MSG="PrÃ©-aquecendo Tool {next_tool} para {trabalho[next_tool]}Â°C"
  {% endif %}

