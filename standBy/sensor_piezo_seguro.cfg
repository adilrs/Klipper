# ConfiguraÃ§Ã£o SEGURA para teste do sensor piezoelÃ©trico
# Use este arquivo se o sensor estiver causando reinicializaÃ§Ãµes
# Substitua [include teste_sensor_piezo.cfg] por [include sensor_piezo_seguro.cfg]

# Sensor piezoelÃ©trico SEM respostas automÃ¡ticas (modo seguro)
# COMENTADO: Conflito com [probe] ativo
#[gcode_button sensor_piezo]
#pin: ^host:gpio22  # Pino 15 fÃ­sico do Raspberry Pi com pull-up interno
# press_gcode e release_gcode comentados para evitar instabilidade
# press_gcode:
#     RESPOND MSG="ðŸ”´ Sensor acionado"
# release_gcode:
#     RESPOND MSG="ðŸŸ¢ Sensor liberado"

# Macro para teste manual do sensor (mais segura)
[gcode_macro TESTE_PIEZO_SEG]
description: Testa o sensor piezoelÃ©trico de forma segura
gcode:
    RESPOND MSG="=== TESTE SEGURO DO SENSOR PIEZOELÃ‰TRICO ==="
    RESPOND MSG="Estado atual: {printer['gcode_button sensor_piezo'].state}"
    RESPOND MSG="0 = NÃ£o pressionado | 1 = Pressionado"
    RESPOND MSG="Pressione o sensor e execute novamente para ver mudanÃ§a"
    RESPOND MSG="============================================"

# Macro para monitoramento manual (sem loop automÃ¡tico)
[gcode_macro VERIFICAR_SENSOR_PIEZO]
description: Verifica o estado atual do sensor
gcode:
    {% set estado = printer['gcode_button sensor_piezo'].state %}
    {% if estado == 1 %}
        RESPOND MSG="ðŸ”´ Sensor ACIONADO (estado: {estado})"
    {% else %}
        RESPOND MSG="ðŸŸ¢ Sensor LIBERADO (estado: {estado})"
    {% endif %}

# Macro de diagnÃ³stico simplificada
[gcode_macro DIAG_SENSOR_SEG]
description: DiagnÃ³stico bÃ¡sico do sensor piezoelÃ©trico
gcode:
    RESPOND MSG="ðŸ“‹ DIAGNÃ“STICO DO SENSOR PIEZOELÃ‰TRICO"
    RESPOND MSG="- Pino: ^host:gpio22 (Pino 15 fÃ­sico)"
    RESPOND MSG="- Pull-up: Ativo"
    RESPOND MSG="- Estado atual: {printer['gcode_button sensor_piezo'].state}"
    RESPOND MSG="- Modo: SEGURO (sem respostas automÃ¡ticas)"
    RESPOND MSG=""
    RESPOND MSG="ðŸ’¡ Para testar: TESTE_SENSOR_PIEZO_SEGURO"
    RESPOND MSG="ðŸ’¡ Para verificar: VERIFICAR_SENSOR_PIEZO"