# Guia de Ajuste de Sensibilidade do Sensor PiezoelÃ©trico
# Use este arquivo para calibrar a sensibilidade ideal

[gcode_macro CALIB_SENS_PIEZO]
description: Guia passo-a-passo para ajustar a sensibilidade do sensor
gcode:
    RESPOND MSG="ğŸ”§ CALIBRAÃ‡ÃƒO DE SENSIBILIDADE - SENSOR PIEZOELÃ‰TRICO"
    RESPOND MSG="â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    RESPOND MSG=""
    RESPOND MSG="ğŸ“ SITUAÃ‡ÃƒO ATUAL: LED sÃ³ pisca com impacto forte"
    RESPOND MSG="ğŸ¯ OBJETIVO: Ajustar para detectar toques leves"
    RESPOND MSG=""
    RESPOND MSG="ğŸ”§ INSTRUÃ‡Ã•ES DE AJUSTE:"
    RESPOND MSG="1. Localize o potenciÃ´metro (parafuso pequeno) na placa LM393"
    RESPOND MSG="2. Use uma chave de fenda pequena ou chave Phillips"
    RESPOND MSG="3. Gire LENTAMENTE no sentido HORÃRIO (aumenta sensibilidade)"
    RESPOND MSG="4. FaÃ§a 1/4 de volta por vez"
    RESPOND MSG="5. Teste apÃ³s cada ajuste com toque leve"
    RESPOND MSG=""
    RESPOND MSG="âš ï¸  CUIDADO:"
    RESPOND MSG="- NÃƒO gire muito rÃ¡pido ou muito longe"
    RESPOND MSG="- Se ficar muito sensÃ­vel, gire anti-horÃ¡rio"
    RESPOND MSG="- Teste sempre apÃ³s cada ajuste"
    RESPOND MSG=""
    RESPOND MSG="ğŸ§ª Para testar: TESTE_TOQUE_LEVE"
    RESPOND MSG="Estado atual do sensor: {printer['gcode_button sensor_piezo'].state}"

[gcode_macro TESTE_TOQUE_LEVE]
description: Teste especÃ­fico para toques leves
gcode:
    RESPOND MSG="ğŸ‘† TESTE DE TOQUE LEVE"
    RESPOND MSG="â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    RESPOND MSG="Estado inicial: {printer['gcode_button sensor_piezo'].state}"
    RESPOND MSG=""
    RESPOND MSG="ğŸ“‹ FAÃ‡A AGORA:"
    RESPOND MSG="1. Toque MUITO LEVEMENTE o sensor (como uma pena)"
    RESPOND MSG="2. Observe se aparece 'ğŸ”´ Sensor acionado'"
    RESPOND MSG="3. Solte e veja se aparece 'ğŸŸ¢ Sensor liberado'"
    RESPOND MSG=""
    RESPOND MSG "âœ… SE FUNCIONOU: Sensibilidade estÃ¡ boa!"
    RESPOND MSG="âŒ SE NÃƒO FUNCIONOU: Gire potenciÃ´metro 1/4 volta horÃ¡rio"
    RESPOND MSG=""
    RESPOND MSG="Estado atual: {printer['gcode_button sensor_piezo'].state}"

[gcode_macro TESTE_PROG_SENS]
description: Teste com diferentes nÃ­veis de forÃ§a
gcode:
    RESPOND MSG="ğŸ“Š TESTE PROGRESSIVO DE SENSIBILIDADE"
    RESPOND MSG="â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    RESPOND MSG=""
    RESPOND MSG="Vamos testar 4 nÃ­veis de toque:"
    RESPOND MSG=""
    
    # NÃ­vel 1 - Muito leve
    RESPOND MSG="ğŸª¶ NÃVEL 1: TOQUE MUITO LEVE (como uma pena)"
    RESPOND MSG="Toque agora e aguarde 3 segundos..."
    G4 P3000
    RESPOND MSG="Resultado NÃ­vel 1: {printer['gcode_button sensor_piezo'].state}"
    RESPOND MSG=""
    
    # NÃ­vel 2 - Leve
    RESPOND MSG="ğŸ‘† NÃVEL 2: TOQUE LEVE (dedo suave)"
    RESPOND MSG="Toque agora e aguarde 3 segundos..."
    G4 P3000
    RESPOND MSG="Resultado NÃ­vel 2: {printer['gcode_button sensor_piezo'].state}"
    RESPOND MSG=""
    
    # NÃ­vel 3 - Normal
    RESPOND MSG="âœ‹ NÃVEL 3: TOQUE NORMAL"
    RESPOND MSG="Toque agora e aguarde 3 segundos..."
    G4 P3000
    RESPOND MSG="Resultado NÃ­vel 3: {printer['gcode_button sensor_piezo'].state}"
    RESPOND MSG=""
    
    # NÃ­vel 4 - Firme
    RESPOND MSG="ğŸ‘Š NÃVEL 4: TOQUE FIRME"
    RESPOND MSG="Toque agora e aguarde 3 segundos..."
    G4 P3000
    RESPOND MSG="Resultado NÃ­vel 4: {printer['gcode_button sensor_piezo'].state}"
    RESPOND MSG=""
    
    RESPOND MSG="ğŸ“‹ ANÃLISE DOS RESULTADOS:"
    RESPOND MSG="- Ideal: NÃ­veis 1-3 devem detectar (estado = 1)"
    RESPOND MSG="- Se sÃ³ NÃ­vel 4 detecta: Gire potenciÃ´metro horÃ¡rio"
    RESPOND MSG="- Se todos detectam: Sensibilidade estÃ¡ boa!"
    RESPOND MSG="- Se detecta sem tocar: Gire potenciÃ´metro anti-horÃ¡rio"

[gcode_macro MONITOR_REAL_TIME]
description: Monitor em tempo real durante ajuste do potenciÃ´metro
gcode:
    {% set duracao = params.DURACAO|default(60)|int %}
    
    RESPOND MSG="â±ï¸  MONITOR DE AJUSTE EM TEMPO REAL"
    RESPOND MSG="â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    RESPOND MSG="DuraÃ§Ã£o: {duracao} segundos"
    RESPOND MSG=""
    RESPOND MSG="ğŸ”§ INSTRUÃ‡Ã•ES:"
    RESPOND MSG="1. Deixe esta macro rodando"
    RESPOND MSG="2. Ajuste o potenciÃ´metro lentamente"
    RESPOND MSG="3. Teste toques leves enquanto ajusta"
    RESPOND MSG="4. Observe as mudanÃ§as em tempo real"
    RESPOND MSG=""
    
    {% set total_checks = duracao * 2 %}  # Verifica a cada 0.5s
    {% for i in range(total_checks) %}
        {% set tempo = (i * 0.5)|round(1) %}
        {% set estado = printer['gcode_button sensor_piezo'].state %}
        
        {% if estado == 1 %}
            RESPOND MSG="ğŸ”´ {tempo}s: SENSOR ACIONADO!"
        {% else %}
            RESPOND MSG="ğŸŸ¢ {tempo}s: Sensor livre"
        {% endif %}
        
        G4 P500  # 0.5 segundos
        
        {% if (i + 1) % 20 == 0 %}
            {% set progresso = ((i + 1) / total_checks * 100)|int %}
            RESPOND MSG="ğŸ“Š Progresso: {progresso}% - Continue ajustando..."
        {% endif %}
    {% endfor %}
    
    RESPOND MSG="âœ… Monitoramento concluÃ­do!"
    RESPOND MSG="Execute TESTE_TOQUE_LEVE para verificar resultado final"